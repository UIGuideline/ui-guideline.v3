---
import { ClientSectionWrapper } from '@composed';
import { ComponentDetailLayout } from '@layouts';
import { camelToKebab, camelToTitleCase, renderSections, SectionKey } from '@lib';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const components = await getCollection('components');
	return components.map((component) => ({
		params: { slug: component.data.slug },
		props: { component },
	}));
}

const { component } = Astro.props;
const entry = component;
if (!entry) throw new Error(`Component not found`);

const sections = (entry.data.sections ?? []) as SectionKey[];
const rendered = await renderSections(sections, {
	slug: entry.data.slug,
	basePath: '',
	title: entry.data.title,
});

const tocItems = sections.map((key) => ({
	id: camelToKebab(key),
	label: camelToTitleCase(key),
}));
---

<ComponentDetailLayout
	title={`${entry.data.title} | UI Guideline`}
	description={`${entry.data.title} component documentation from leading design systems.`}
	currentSlug={entry.data.slug}
	toc={tocItems}
>
	<div class="space-y-8">
		{
			rendered.map((Section) => {
				if (!Section) return null;

				// Client section (island with hydration)
				if (typeof Section === 'object' && 'isClient' in Section) {
					return (
						<section class="scroll-mt-20">
							<ClientSectionWrapper
								type={Section.type}
								data={Section.data as any}
								designLayers={Section.designLayers as any}
								codeAnatomy={Section.codeAnatomy as any}
								client:load
							/>
						</section>
					);
				}

				// Server-rendered section
				return (
					<section class="scroll-mt-20">
						<Section />
					</section>
				);
			})
		}
	</div>
</ComponentDetailLayout>
