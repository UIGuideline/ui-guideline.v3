---
import { ComponentDetailLayout } from '@layouts';
import { camelToKebab, camelToTitleCase, CONTENT_PATHS, renderSections, type SectionKey } from '@lib';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const components = await getCollection('components');
	return components.map((component) => ({
		params: { slug: component.data.slug },
		props: { component },
	}));
}

const { component } = Astro.props;
const entry = component;
if (!entry) throw new Error(`Component not found`);

const basePath = `${CONTENT_PATHS.COMPONENTS}/${entry.id}`;
const sections = (entry.data.sections ?? []) as SectionKey[];
const rendered = await renderSections(sections, {
	slug: entry.data.slug,
	basePath,
	title: entry.data.title,
});

// Generate TOC from sections
const tocItems = sections.map((key) => ({
	id: camelToKebab(key),
	label: camelToTitleCase(key),
}));
---

<ComponentDetailLayout
	title={`${entry.data.title} | UI Guideline`}
	description={`${entry.data.title} component documentation from leading design systems.`}
	currentSlug={entry.data.slug}
	toc={tocItems}
>
	<!-- Dynamic Sections -->
	<div class="space-y-16">
		{
			rendered.map(
				(Section) =>
					Section && (
						<section class="scroll-mt-20">
							<Section />
						</section>
					),
			)
		}
	</div>
</ComponentDetailLayout>
