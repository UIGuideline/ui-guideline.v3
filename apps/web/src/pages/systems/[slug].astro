---
import { getSystemThumbnailUrl, ROUTES } from '@common';
import { SystemOverview } from '@composed';
import { SystemsLayout } from '@layouts';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
	const systems = await getCollection('systemList');
	return systems.map((system) => ({
		params: { slug: system.data.slug },
		props: { system },
	}));
}

const { system } = Astro.props;
const entry = system;
if (!entry) throw new Error(`System not found`);

// Get system components
const systemComponentsEntry = await getEntry('systemComponents', `${entry.data.slug}/components`);
const systemComponentsData = systemComponentsEntry?.data;

// Get all components to match slugs with titles
const allComponents = await getCollection('componentList');
const componentMap = new Map(allComponents.map((c) => [c.data.slug, c.data.title]));

// Map component slugs to component info
const componentsInfo = systemComponentsData?.components
	.map((slug: string) => {
		const title = componentMap.get(slug);
		return title ? { slug, title } : null;
	})
	.filter(Boolean) as Array<{ slug: string; title: string }>;

const logoUrl = getSystemThumbnailUrl(entry.data.slug);
---

<SystemsLayout
	title={`${entry.data.name} | UI Guideline`}
	description={`${entry.data.description}`}
	currentSlug={entry.data.slug}
>
	<div class="flex flex-col gap-16">
		<SystemOverview
			client:load
			slug={entry.data.slug}
			name={entry.data.name}
			description={entry.data.description}
			contributors={entry.data.contributors}
		/>

		<!-- System Components -->
		<section class="flex flex-col gap-3">
			<h1 id="components" class="text-xl font-bold m-0">Components</h1>
			<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
				{
					componentsInfo.map((component) => (
						<a
							href={`${ROUTES.COMPONENTS}/${component.slug}`}
							class="px-4 py-2 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-gray-300 dark:hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors text-center"
						>
							{component.title}
						</a>
					))
				}
			</div>
		</section>
	</div>
</SystemsLayout>
