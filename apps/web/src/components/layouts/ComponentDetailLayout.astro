---
import { BaseLayout } from '@layouts';
import { Navbar, SideBar, SideNav, TableOfContent } from '@ui';
import { getCollection } from 'astro:content';

export interface Props {
	/**
	 * The title of the page.
	 */
	title: string;

	/**
	 * The description of the page for SEO.
	 */
	description?: string;

	/**
	 * The current component slug for active state.
	 */
	currentSlug?: string;

	/**
	 * Optional Table of Contents items.
	 */
	toc?: Array<{ id: string; label: string }>;
}

const { title, description, currentSlug, toc } = Astro.props;

console.log(toc);

// Get all components for navigation
const allComponents = await getCollection('components');
const sortedComponents = allComponents.sort((a, b) => a.data.title.localeCompare(b.data.title));
---

<BaseLayout title={title} description={description}>
	<!-- Skip to main content link for accessibility -->
	<a
		href="#main-content"
		class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-black focus:rounded"
	>
		Skip to main content
	</a>

	<div class="flex flex-col min-h-screen">
		<!-- Top Navigation -->
		<header class="sticky top-0 z-40 w-full bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
			<Navbar client:load />
		</header>

		<div class="flex flex-1 relative">
			<!-- Left Sidebar - Component Navigation -->
			<SideBar>
				<SideNav>
					<SideNav.Section>
						<SideNav.Heading>Components</SideNav.Heading>
						<SideNav.List>
							{
								sortedComponents.map((component) => (
									<SideNav.Item level={1}>
										<SideNav.Link
											href={`/components/${component.slug}`}
											className={currentSlug === component.slug ? 'text-neutral-50 font-normal' : ''}
										>
											{component.data.title}
										</SideNav.Link>
									</SideNav.Item>
								))
							}
						</SideNav.List>
					</SideNav.Section>
				</SideNav>
			</SideBar>

			<!-- Main Content Area -->
			<main id="main-content" class="flex-1 w-full max-w-[1400px] mx-auto px-6 py-8 lg:px-12 lg:py-12" role="main">
				<article class="max-w-none">
					<slot />
				</article>
			</main>

			<!-- Right Sidebar - Table of Contents -->
			<aside
				class="hidden xl:block sticky top-14.25 right-0 w-64 h-fit max-h-[calc(100dvh-var(--spacing)*14.25)] overflow-y-auto p-6"
				aria-label="Table of contents"
			>
				<TableOfContent client:load items={toc} className="sticky top-0 h-screen" />
			</aside>
		</div>
	</div>
</BaseLayout>

<style>
	/* Skip link styles */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	.focus\:not-sr-only:focus {
		position: static;
		width: auto;
		height: auto;
		padding: 0.5rem 1rem;
		margin: 0;
		overflow: visible;
		clip: auto;
		white-space: normal;
	}
</style>
