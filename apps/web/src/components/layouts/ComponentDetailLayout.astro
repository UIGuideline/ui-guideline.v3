---
import { BaseLayout } from '@layouts';
import { Navbar, SideBar, SideNav, TableOfContent } from '@ui';
import { getCollection } from 'astro:content';

export interface Props {
	/**
	 * The title of the page.
	 */
	title: string;

	/**
	 * The description of the page for SEO.
	 */
	description?: string;

	/**
	 * The current component slug for active state.
	 */
	currentSlug?: string;

	/**
	 * Optional Table of Contents items.
	 */
	toc?: Array<{ id: string; label: string }>;
}

const { title, description, currentSlug, toc } = Astro.props;

// Get all components for navigation
const allComponents = await getCollection('components');
const sortedComponents = allComponents.sort((a, b) => a.data.title.localeCompare(b.data.title));
---

<BaseLayout title={title} description={description}>
	<!-- Skip to main content link for accessibility -->
	<a
		href="#main-content"
		class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-black focus:rounded"
	>
		Skip to main content
	</a>

	<!-- Top Navigation -->
	<header class="sticky top-0 w-full border-b border-neutral-200 dark:border-neutral-800 z-40">
		<Navbar className="@md:max-w-[1350px] mx-auto border-dashed-wide" />
	</header>

	<div class="flex flex-col min-h-screen @md:max-w-[1350px] mx-auto border-dashed-wide">
		<div class="flex flex-1 relative">
			<!-- Left Sidebar - Component Navigation (Fixed Width: 384px) -->
			<div class="hidden lg:block w-60 flex-shrink-0">
				<SideBar>
					<SideNav>
						<SideNav.Section>
							<SideNav.Heading>Components</SideNav.Heading>
							<SideNav.List>
								{
									sortedComponents.map((component) => (
										<SideNav.Item level={1}>
											<SideNav.Link
												href={`/components/${component.slug}`}
												className={currentSlug === component.slug ? 'text-neutral-50 font-normal' : ''}
											>
												{component.data.title}
											</SideNav.Link>
										</SideNav.Item>
									))
								}
							</SideNav.List>
						</SideNav.Section>
					</SideNav>
				</SideBar>
			</div>

			<!-- Main Content Area (Flexible) -->
			<main id="main-content" class="flex-1 min-w-0 px-6 py-8 lg:px-12 lg:py-12" role="main">
				<article class="max-w-none">
					<slot />
				</article>
			</main>

			<!-- Right Sidebar - Table of Contents (Fixed Width: 384px) -->
			<div class="hidden xl:block w-60 flex-shrink-0">
				<aside
					class="sticky top-12 right-0 h-fit max-h-[calc(100dvh-var(--spacing)*14.25)] overflow-y-auto p-6"
					aria-label="Table of contents"
				>
					<TableOfContent client:load items={toc} className="sticky top-0 h-screen" />
				</aside>
			</div>
		</div>
	</div>
</BaseLayout>

<style>
	/* Skip link styles */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}

	.focus\:not-sr-only:focus {
		position: static;
		width: auto;
		height: auto;
		padding: 0.5rem 1rem;
		margin: 0;
		overflow: visible;
		clip: auto;
		white-space: normal;
	}
</style>
