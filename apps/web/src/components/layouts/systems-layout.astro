---
import { ROUTES } from '@common';
import { BaseLayout } from '@layouts';
import { Navbar, SideBar, SideNav } from '@ui';
import { getCollection } from 'astro:content';

export interface Props {
	/**
	 * The title of the page.
	 */
	title: string;

	/**
	 * The description of the page for SEO.
	 */
	description?: string;

	/**
	 * The current system slug for active state.
	 */
	currentSlug?: string;
}

const { title, description, currentSlug } = Astro.props;

// Get all systems for navigation
const systemList = await getCollection('systemList');
const sortedSystems = systemList.slice().sort((a, b) => a.data.name.localeCompare(b.data.name));
---

<BaseLayout title={title} description={description}>
	<!-- Top Navigation -->
	<header class="sticky top-0 w-full border-b border-border z-40">
		<Navbar
			client:load
			className="@md:max-w-[1350px] mx-auto border-x border-border backdrop-blur-sm bg-background/90"
		/>
	</header>

	<div class="flex flex-col min-h-screen @md:max-w-[1350px] mx-auto border-dashed-wide">
		<div class="flex flex-1 relative">
			<!-- Left Sidebar - Systems Navigation (Fixed Width: 256px) -->
			<div class="hidden lg:block w-64 flex-shrink-0">
				<SideBar>
					<SideNav>
						<!-- Section - OVERVIEW -->
						<SideNav.Section>
							<SideNav.Heading className="mb-4">Overview</SideNav.Heading>
							<SideNav.List>
								{/* Empty list - prepared for future overview docs */}
							</SideNav.List>
						</SideNav.Section>

						<!-- Section: SYSTEMS -->
						<SideNav.Section>
							<SideNav.Heading>Systems</SideNav.Heading>
							<SideNav.List className="mt-2">
								{
									sortedSystems.map((system) => (
										<SideNav.Item level={1} isActive={currentSlug === system.data.slug}>
											<SideNav.Link
												level={1}
												href={`${ROUTES.SYSTEMS}/${system.data.slug}`}
												isActive={currentSlug === system.data.slug}
											>
												{system.data.name}
											</SideNav.Link>
										</SideNav.Item>
									))
								}
							</SideNav.List>
						</SideNav.Section>
					</SideNav>
				</SideBar>
			</div>

			<!-- Main Content Area (Flexible) -->
			<main id="main-content" class="flex-1 min-w-0 px-12 py-8 lg:py-12" role="main">
				<article class="max-w-none">
					<slot />
				</article>
			</main>
		</div>
	</div>
</BaseLayout>
